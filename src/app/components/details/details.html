<div class="container my-5">

  @if (product(); as productItem) {
    <div class="row">
      <!-- Columna del Carrusel de Imágenes -->
      <div class="col-md-6">
        
        <!-- Verificamos si hay imágenes disponibles -->
        @if (productItem.imagenes && productItem.imagenes.length > 0) {
          
          <div id="productImageCarousel" class="carousel slide shadow-lg rounded" data-bs-ride="carousel">
            
            <!-- Indicadores del Carrusel (los puntos de abajo) -->
            <!-- Solo se muestran si hay más de una imagen -->
            @if (productItem.imagenes.length > 1) {
              <div class="carousel-indicators">
                @for (imagen of productItem.imagenes; track imagen.id; let i = $index) {
                  <button type="button" data-bs-target="#productImageCarousel" [attr.data-bs-slide-to]="i" [class.active]="$first" [attr.aria-current]="$first ? 'true' : 'false'" [attr.aria-label]="'Slide ' + (i + 1)"></button>
                }
              </div>
            }

            <!-- Contenido del Carrusel (las imágenes) -->
            <div class="carousel-inner rounded">
              @for (imagen of productItem.imagenes; track imagen.id) {
                <div class="carousel-item" [class.active]="$first">
                  <img [src]="'http://localhost:3000' + imagen.imageUrl" class="d-block w-100 product-image" [alt]="productItem.name + ' - Ansicht ' + ($index + 1)">
                </div>
              }
            </div>

            <!-- Controles Izquierda/Derecha -->
            <!-- Solo se muestran si hay más de una imagen -->
            @if (productItem.imagenes.length > 1) {
              <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            }
          </div>

        } @else {
          <!-- Fallback si no hay imágenes -->
          <img src="assets/images/placeholder.jpg" class="img-fluid rounded shadow-lg" [alt]="productItem.name">
        }

      </div>
      <div class="col-md-6 d-flex flex-column justify-content-center">
        <h1 class="item-name">{{ productItem.name }}</h1>
        <p class="lead description">{{ productItem.description }}</p>
        <p class="price text-white">{{ productItem.price | currency:'CHF' }}</p>
        @if (productItem.stock>0) {
                  <p class="existe">vorhanden</p>

        }@else {
          <p class="noexiste">im Moment gibt es keine.</p>
        }
        <div class="mt-4">
          <button class="btn btn-primary btn-lg" [ngClass]="productItem.stock<1 ? 'disabled' : ''"
           (click)="addItemToCart()" [disabled]="addedToCart()">

            <!-- También actualizamos el botón a la nueva sintaxis -->
            @if (!addedToCart()) {
              <span>
                <i class="bi bi-cart-plus"></i> In den Warenkorb
              </span>
            } @else {
              <span>
                Hinzugefügt! <i class="bi bi-check-lg"></i>
              </span>
            }

          </button>
        </div>
      </div>
    </div>
  } @else {
    <!-- El bloque @else se muestra cuando la condición @if es falsa -->
    <p class="text-center">Produkt nicht gefunden. <a routerLink="/products">Zurück zur Kollektion</a>.</p>
  }

</div>